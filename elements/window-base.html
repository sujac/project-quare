<link rel="import" href="../bower_components/polymer/polymer.html">

<polymer-element name="window-base" attributes="height width left top marginTop" class="active">
    <template>
        <link rel="stylesheet" href="window-base.css">
        <div id="box">
            <div class="resizer" id="resizer-top" on-track="{{trackTop}}"></div>
            <div class="resizer" id="resizer-left" on-track="{{trackLeft}}"></div>
            <div class="resizer" id="resizer-bottom" on-track="{{trackBottom}}"></div>
            <div class="resizer" id="resizer-right" on-track="{{trackRight}}"></div>
            <div class="resizer" id="bottom-right-diagonal" on-track="{{trackBottomRight}}"></div>
            <div class="resizer" id="bottom-left-diagonal" on-track="{{trackBottomLeft}}"></div>
            <div class="resizer" id="top-right-diagonal" on-track="{{trackTopRight}}"></div>
            <div class="resizer" id="top-left-diagonal" on-track="{{trackTopLeft}}"></div>
            <header id="header" on-trackstart="{{trackStartDraggable}}" on-track="{{trackDraggable}}" on-trackend="{{trackEndDraggable}}">
                <div class="action-button" id="close" on-click="{{closeWindow}}"></div>
            </header>
            <content></content>
        </div>
    </template>
    <script>
        Polymer('window-base', {
            height: 400,
            width: 500,
            minHeight: 400,
            minWidth: 400,
            zindex: 8,
            pointerX: 0,
            pointerY: 0,
            marginTop: 0,
            left: 300,
            top: 200,
            observe: {
                left: 'positionChanged',
                top: 'positionChanged'
            },
            ready: function () {
                this.heightChanged();
                this.widthChanged();
                this.positionChanged();
            },
            heightChanged: function () {
                this.$.box.style.height = this.height + 'px';
            },
            widthChanged: function () {
                this.$.box.style.width = this.width + 'px';
            },
            positionChanged: function () {
                var s = this.style;
                var translate = "translate(" + this.left + "px, " + this.top + "px)";
                s.webkitTransform = s.mozTransform = s.msTransform = s.transform = translate;
            },
            trackRight: function (event, detail, sender) {
                this.width = event.clientX - this.left;
            },
            trackLeft: function (event, detail, sender) {
                this.width = this.width - (event.clientX - this.left);
                this.left = event.clientX;
            },
            trackBottom: function (event, detail, sender) {
                this.height = event.clientY - this.top;
            },
            trackTop: function (event, detail, sender) {
                this.height = this.height - (event.clientY - this.top);
                this.top = event.clientY;
            },
            trackBottomRight: function (event, detail, sender) {
                this.width = event.clientX - this.left;
                this.height = event.clientY - this.top;
            },
            trackBottomLeft: function (event, detail, sender) {
                this.height = event.clientY - this.top;
                this.width = this.width - (event.clientX - this.left);
                this.left = event.clientX;
            },
            trackTopRight: function (event, detail, sender) {
                this.height = this.height - (event.clientY - this.top);
                this.top = event.clientY;
                this.width = event.clientX - this.left;
            },
            trackTopLeft: function (event, detail, sender) {
                this.height = this.height - (event.clientY - this.top);
                this.top = event.clientY;
                this.width = this.width - (event.clientX - this.left);
                this.left = event.clientX;
            },
            trackStartDraggable: function (event, detail, sender) {
                this.$.header.classList.add('dragging');
                if (this.classList.contains("resized")) {
                    this.width = this.minWidth;
                    this.height = this.minHeight;
                    this.classList.remove("resized")
                }
                this.pointerY = event.clientY - this.top;
                this.pointerX = event.clientX - this.left;
            },
            trackDraggable: function (event, detail, sender) {
                this.top = event.clientY - this.pointerY;
                this.left = event.clientX - this.pointerX;
            },
            trackEndDraggable: function (event, detail, sender) {
                this.$.header.classList.remove('dragging');
                var screenWidth = window.innerWidth;
                var screenHeight = window.innerHeight;
                if (event.clientX >= (screenWidth - 10)) {
                    this.classList.add('resized');
                    this.minWidth = this.width;
                    this.minHeight = this.height;
                    this.width = screenWidth / 2;
                    this.left = screenWidth / 2;
                    this.height = screenHeight;
                    this.top = this.marginTop;
                } else if (event.clientX <= 10) {
                    this.classList.add('resized');
                    this.minWidth = this.width;
                    this.minHeight = this.height;
                    this.width = screenWidth / 2;
                    this.left = 0;
                    this.height = screenHeight;
                    this.top = this.marginTop;
                }
            },
            closeWindow: function (event, detail, sender) {
                this.parentNode.removeChild(this);
            }
        });
    </script>
</polymer-element>
